
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://grex-telescope.github.io/software/server_setup/">
      
      <link rel="icon" href="../../assets/grex_icon.svg">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>Server Setup - GReX Telescope</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#server-setup" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="GReX Telescope" class="md-header__button md-logo" aria-label="GReX Telescope" data-md-component="logo">
      
  <img src="../../assets/grex_icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GReX Telescope
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Server Setup
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hardware/overview/" class="md-tabs__link">
        Hardware
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../overview/" class="md-tabs__link md-tabs__link--active">
        Software
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../about/" class="md-tabs__link">
      About
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="GReX Telescope" class="md-nav__button md-logo" aria-label="GReX Telescope" data-md-component="logo">
      
  <img src="../../assets/grex_icon.svg" alt="logo">

    </a>
    GReX Telescope
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Hardware
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hardware" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Hardware
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/feed/" class="md-nav__link">
        Feed Antenna
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/fem/" class="md-nav__link">
        Fronend Module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/fpga/" class="md-nav__link">
        Digital Backend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/box/" class="md-nav__link">
        The Box
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/assembly/" class="md-nav__link">
        Assembly Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Software" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../stack/" class="md-nav__link">
        Software Stack
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../snap/" class="md-nav__link">
        SNAP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline/" class="md-nav__link">
        Pipeline
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Server Setup
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Server Setup
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hardware-setup" class="md-nav__link">
    Hardware Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initial-os-setup" class="md-nav__link">
    Initial OS Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#networking" class="md-nav__link">
    Networking
  </a>
  
    <nav class="md-nav" aria-label="Networking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#netplan" class="md-nav__link">
    Netplan
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-server" class="md-nav__link">
    DHCP Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-10-gbe-settings" class="md-nav__link">
    Advanced 10 GbE Settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpu-drivers-cuda" class="md-nav__link">
    GPU Drivers / CUDA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-dependencies" class="md-nav__link">
    Pipeline Dependencies
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Dependencies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#psrdada" class="md-nav__link">
    PSRDADA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heimdall" class="md-nav__link">
    Heimdall
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdf5netcdf" class="md-nav__link">
    HDF5/NetCDF
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rust" class="md-nav__link">
    Rust
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python" class="md-nav__link">
    Python
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-software" class="md-nav__link">
    Pipeline Software
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-injection-and-coincidencing" class="md-nav__link">
    Pipeline Injection and Coincidencing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#databases-and-metrics-collection" class="md-nav__link">
    Databases and Metrics Collection
  </a>
  
    <nav class="md-nav" aria-label="Databases and Metrics Collection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grafana" class="md-nav__link">
    Grafana
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#observability-stack" class="md-nav__link">
    Observability Stack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pi-ssh" class="md-nav__link">
    Pi SSH
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../box/" class="md-nav__link">
        Box Setup
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../operation/" class="md-nav__link">
        Operation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../data_processing/" class="md-nav__link">
        Data Processing
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hardware-setup" class="md-nav__link">
    Hardware Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#initial-os-setup" class="md-nav__link">
    Initial OS Setup
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#networking" class="md-nav__link">
    Networking
  </a>
  
    <nav class="md-nav" aria-label="Networking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    Overview
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#netplan" class="md-nav__link">
    Netplan
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#dhcp-server" class="md-nav__link">
    DHCP Server
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#advanced-10-gbe-settings" class="md-nav__link">
    Advanced 10 GbE Settings
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpu-drivers-cuda" class="md-nav__link">
    GPU Drivers / CUDA
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-dependencies" class="md-nav__link">
    Pipeline Dependencies
  </a>
  
    <nav class="md-nav" aria-label="Pipeline Dependencies">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#psrdada" class="md-nav__link">
    PSRDADA
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#heimdall" class="md-nav__link">
    Heimdall
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#hdf5netcdf" class="md-nav__link">
    HDF5/NetCDF
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#rust" class="md-nav__link">
    Rust
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#python" class="md-nav__link">
    Python
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-software" class="md-nav__link">
    Pipeline Software
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pipeline-injection-and-coincidencing" class="md-nav__link">
    Pipeline Injection and Coincidencing
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#databases-and-metrics-collection" class="md-nav__link">
    Databases and Metrics Collection
  </a>
  
    <nav class="md-nav" aria-label="Databases and Metrics Collection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#grafana" class="md-nav__link">
    Grafana
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#docker" class="md-nav__link">
    Docker
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#observability-stack" class="md-nav__link">
    Observability Stack
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pi-ssh" class="md-nav__link">
    Pi SSH
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="server-setup">Server Setup</h1>
<p>Once you get your server (either from Puget systems or otherwise), we need to setup additional hardware, adjust some system settings, setup networking, and install the pipeline software.</p>
<h2 id="hardware-setup">Hardware Setup</h2>
<p>The server straight from Puget does not have the GPU or 10 GbE network card installed, we will do this first.</p>
<ol>
<li>Open the case and remove the GPU retention bracket</li>
<li>Remove the test GPU (T1000), keep this for later in case we need an aditional video output</li>
<li>Install the 3090 Ti in the first GPU slot, this will take up three slots of space</li>
<li>Install the network card in the bottom slot</li>
<li>Wire the 3090 Ti power cable to the harness provided by Puget (they knew this was the GPU we were going to install)</li>
<li>Remove the GPU retention clips from the retention bracket that would interfere with the card. It's too tall for it anyway.</li>
<li>Replace the retention bracket and close the case.</li>
</ol>
<p><img alt="" src="../../assets/server.jpg" /></p>
<p>Finally, we need to hook up a monitor to the 3090 Ti so we can setup the software</p>
<h2 id="initial-os-setup">Initial OS Setup</h2>
<p>On boot, you will be presented with the Ubuntu graphical interface. If a password is requested, the deafult is provided in the information booklet that came with the hardware.</p>
<p>First, we will change the system password. Set this to something memorable.</p>
<div class="highlight"><pre><span></span><code>passwd <span class="k">$(</span>whoami<span class="k">)</span>
</code></pre></div>
<p>Now, we will update the system. There shouldn't be many updates if this is a new machine.</p>
<div class="highlight"><pre><span></span><code>sudo apt-get update
sudo apt-get upgrade -y
</code></pre></div>
<p>We will be editing a bunch of files, if you are comfy in the command line, you probably want to install some editors. Otherwise the graphical <code>gedit</code> tool will be fine.</p>
<div class="highlight"><pre><span></span><code>sudo apt-get install emacs vim -y
</code></pre></div>
<p>We also need <code>clang</code> for compiling C-family libraries.</p>
<div class="highlight"><pre><span></span><code>sudo apt-get install clang -y
</code></pre></div>
<p>Finally, we will set the hostname. We'll be using the <code>grex-&lt;affiliation&gt;-&lt;location&gt;</code> paradigm (just for clarity, no real reason not to).
As in, the first server that is managed by Caltech at OVRO will be <code>grex-caltech-ovro</code>.</p>
<div class="highlight"><pre><span></span><code>sudo hostnamectl set-hostname &lt;your-hostname&gt;
</code></pre></div>
<p>Some updates may require a reboot. If it asks, do that now.</p>
<h2 id="networking">Networking</h2>
<p>Now, we need to setup the networking for the GReX system. We will operate under the assumption that the internet-facing connection will get an IP address from a DHCP server. If that is not the case, consult whoever runs your network on the appropriate setup. Regardless of the WAN connection, the 10 GbE fiber connection to the GReX terminal will be configured the same.</p>
<h3 id="overview">Overview</h3>
<p>The 10 GbE fiber port serves a few purposes. It is the main data transfer link between the FPGA in the field and the server, but it also carries the monitor and control for the box. This monitor and control connection includes the SNAP control connection and the Raspberry Pi. The SNAP requires an external DHCP server, which we have to provide on this port. Additionally, the 10 GbE switch in the box has its own default subnet for configuration (<code>192.168.88.X</code>). To make everything talk to each other, we need to add two IPs on this port: one in the subnet of the switch's config interface, and the other for DHCP of the various devices.</p>
<h3 id="netplan">Netplan</h3>
<p>In <code>/etc/netplan</code> remove any files that are currently there.</p>
<p>Check whether you are using NetworkManager or networkd:</p>
<div class="highlight"><pre><span></span><code>systemctl status NetworkManager
systemctl status systemd-networkd
</code></pre></div>
<p>If NetworkManager is running and networkd is not, disable NetworkManager and enable networkd. (Otherwise, skip this step.)</p>
<div class="highlight"><pre><span></span><code>sudo systemctl stop NetworkManager
sudo systemctl disable NetworkManager
sudo systemctl enable systemd-networkd
</code></pre></div>
<p>Then, create a new file called <code>config.yaml</code> with the following contents</p>
<div class="highlight"><pre><span></span><code><span class="nt">network</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w"></span>
<span class="w">  </span><span class="nt">renderer</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networkd</span><span class="w"></span>
<span class="w">  </span><span class="nt">ethernets</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="c1"># Two WAN interfaces. Configure this according to your network setup</span><span class="w"></span>
<span class="w">    </span><span class="nt">enp36s0f0</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">dhcp4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">    </span><span class="nt">enp36s0f1</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">dhcp4</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w"></span>
<span class="w">    </span><span class="c1"># 10 GbE connection over fiber to the box</span><span class="w"></span>
<span class="w">    </span><span class="nt">enp1s0f0</span><span class="p">:</span><span class="w"></span>
<span class="w">      </span><span class="nt">mtu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span><span class="w"></span>
<span class="w">      </span><span class="nt">addresses</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.0.1/24</span><span class="w"></span>
<span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">192.168.88.2/24</span><span class="w"></span>
</code></pre></div>
<p>Then apply with</p>
<div class="highlight"><pre><span></span><code>sudo netplan apply
</code></pre></div>
<h3 id="dhcp-server">DHCP Server</h3>
<p>Now, we need to setup the DHCP server on the 10 GbE port. First, we install the DHCP server software:</p>
<div class="highlight"><pre><span></span><code>sudo apt-get install dnsmasq
</code></pre></div>
<p>Create the configuration file in <code>/etc/dnsmasq.conf</code></p>
<div class="highlight"><pre><span></span><code><span class="c1"># Only bind to the 10 GbE interface</span><span class="w"></span>
<span class="na">interface</span><span class="o">=</span><span class="s">enp1s0f0</span><span class="w"></span>
<span class="c1"># Disable DNS</span><span class="w"></span>
<span class="na">port</span><span class="o">=</span><span class="s">0</span><span class="w"></span>
<span class="c1"># DHCP Options</span><span class="w"></span>
<span class="na">dhcp-range</span><span class="o">=</span><span class="s">192.168.0.0,static</span><span class="w"></span>
<span class="na">dhcp-option</span><span class="o">=</span><span class="s">option:router,192.168.0.1</span><span class="w"></span>
<span class="na">dhcp-option</span><span class="o">=</span><span class="s">option:netmask,255.255.255.0</span><span class="w"></span>
<span class="c1">#dhcp-host=&lt;SNAP_MAC&gt;,192.168.0.3,snap</span><span class="w"></span>
<span class="c1">#dhcp-host=&lt;PI_MAC&gt;,192.168.0.2,pi</span><span class="w"></span>
<span class="na">log-async</span><span class="w"></span>
<span class="na">log-queries</span><span class="w"></span>
<span class="na">log-dhcp</span><span class="w"></span>
</code></pre></div>
<p>Then, enable the DHCP server service</p>
<div class="highlight"><pre><span></span><code>sudo systemctl <span class="nb">enable</span> dnsmasq --now
</code></pre></div>
<p>This sets up a very simple DHCP server that will give the IP address <code>192.168.0.3</code> to the SNAP and <code>192.168.0.2</code> to the Pi.
Unfortunately, the folks who set up the networking interface for the SNAP only provide a DHCP interface and a dynamic (non-observable) MAC address (for some reason). There can also be issues with setting up the Pi within the DHCP server, so it is easiest to set it up alongside the SNAP.
Turn on the SNAP and Pi, wait for them to try to get IP addresses from <code>dnsmasq</code> so we know their MACs, then update the <code>dhcp-host</code> lines for both and restart the DHCP server.</p>
<ol>
<li>Configure the Pi following the instructions in <a href="../box/">box setup</a></li>
<li>Power cycle the SNAP (or turn them on if they weren't turned on yet) following the instructions in <a href="../operation/">operation</a></li>
<li>Wait a moment and open the log of dnsmasq with <code>journalctl -u dnsmasq</code>, skip to the bottom with <code>G</code> (Shift + g)</li>
<li>You should see two lines like this one but with different MAC addresses (and the Pi will say <code>pi</code> rather than <code>no address available</code>, which differentiates it from the SNAP)</li>
</ol>
<div class="highlight"><pre><span></span><code>Aug 16 14:39:06 grex-caltech-ovro dnsmasq-dhcp[5115]: 1085377743 DHCPDISCOVER(enp1s0f0) 00:40:bf:06:13:02 no address available
</code></pre></div>
<p>This implies the SNAP has a MAC address of <code>00:40:bf:06:13:02</code> (yours will be different). 4. Go back and uncomment and edit the <code>dhcp-host</code> lines of <code>/etc/dnsmasq.conf</code> to contain the corresponding MACs for the SNAP and Pi.
For example, in this case we would put <code>dhcp-host=00:40:bf:06:13:02,192.168.0.3,snap</code> 5. Finally, restart the dhcp server with <code>sudo systemctl restart dnsmasq</code></p>
<p>After waiting a bit for the SNAP to send a new request for a DHCP lease, look at the latest logs again from journalctl. If it ends with something like</p>
<div class="highlight"><pre><span></span><code>Aug 16 14:43:02 grex-caltech-ovro dnsmasq-dhcp[6024]: 1085377743 DHCPREQUEST(enp1s0f0) 192.168.0.3 00:40:bf:06:13:02
Aug 16 14:43:02 grex-caltech-ovro dnsmasq-dhcp[6024]: 1085377743 tags: known, enp1s0f0
Aug 16 14:43:02 grex-caltech-ovro dnsmasq-dhcp[6024]: 1085377743 DHCPACK(enp1s0f0) 192.168.0.3 00:40:bf:06:13:02 snap
Aug 16 14:43:02 grex-caltech-ovro dnsmasq-dhcp[6024]: 1085377743 requested options: 1:netmask, 3:router, 28:broadcast, 6:dns-server
Aug 16 14:43:02 grex-caltech-ovro dnsmasq-dhcp[6024]: 1085377743 next server: 192.168.0.1
Aug 16 14:43:02 grex-caltech-ovro dnsmasq-dhcp[6024]: 1085377743 sent size:  1 option: 53 message-type  5
Aug 16 14:43:02 grex-caltech-ovro dnsmasq-dhcp[6024]: 1085377743 sent size:  4 option: 54 server-identifier  192.168.0.1
Aug 16 14:43:02 grex-caltech-ovro dnsmasq-dhcp[6024]: 1085377743 sent size:  4 option: 51 lease-time  1h
Aug 16 14:43:02 grex-caltech-ovro dnsmasq-dhcp[6024]: 1085377743 sent size:  4 option: 58 T1  30m
Aug 16 14:43:02 grex-caltech-ovro dnsmasq-dhcp[6024]: 1085377743 sent size:  4 option: 59 T2  52m30s
Aug 16 14:43:02 grex-caltech-ovro dnsmasq-dhcp[6024]: 1085377743 sent size:  4 option: 28 broadcast  192.168.0.255
Aug 16 14:43:02 grex-caltech-ovro dnsmasq-dhcp[6024]: 1085377743 sent size:  4 option:  1 netmask  255.255.255.0
Aug 16 14:43:02 grex-caltech-ovro dnsmasq-dhcp[6024]: 1085377743 sent size:  4 option:  3 router  192.168.0.1
</code></pre></div>
<p>That means the SNAP got an IP. There should be similar lines for the Pi. You should now be able to <code>ping 192.168.0.3</code> and <code>ping 192.168.0.2</code> to make sure the SNAP and Pi are alive.</p>
<h3 id="advanced-10-gbe-settings">Advanced 10 GbE Settings</h3>
<p>Unfortunately, the OS's default configuration for the 10 GbE network card is not optimized for our use-case of streaming time domain science data. As such, we need to adjust a few things.</p>
<p>Create the file <code>/etc/sysctl.d/20-grex.conf</code> with the following contents:</p>
<div class="highlight"><pre><span></span><code>kernel.shmmax = 68719476736
kernel.shmall = 4294967296
net.core.rmem_max = 536870912
net.core.wmem_max = 536870912
net.core.optmem_max = 16777216
vm.swappiness=1
</code></pre></div>
<p>Then apply these changes with</p>
<div class="highlight"><pre><span></span><code>sudo sysctl --system
</code></pre></div>
<p>Now, we need a program called <code>ethtool</code> to apply some more settings</p>
<div class="highlight"><pre><span></span><code>sudo apt-get install ethtool -y
</code></pre></div>
<p>Now we will create a file to run on boot to apply a sequence of ethtool settings.</p>
<p>Create the file <code>/etc/rc.local</code> with the following contents:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/env bash</span>
ethtool -G enp1s0f0 rx <span class="m">4096</span> tx <span class="m">4096</span>
ethtool -A enp1s0f0 rx on
ethtool -A enp1s0f0 tx on
</code></pre></div>
<p>Make this file executable with</p>
<div class="highlight"><pre><span></span><code>sudo chmod +x /etc/rc.local
</code></pre></div>
<p>Now create the file <code>/etc/systemd/system/rc-local.service</code> with the following contents:</p>
<div class="highlight"><pre><span></span><code><span class="k">[Unit]</span><span class="w"></span>
<span class="w"> </span><span class="na">Description</span><span class="o">=</span><span class="s">/etc/rc.local Compatibility</span><span class="w"></span>
<span class="w"> </span><span class="na">ConditionPathExists</span><span class="o">=</span><span class="s">/etc/rc.local</span><span class="w"></span>

<span class="k">[Service]</span><span class="w"></span>
<span class="w"> </span><span class="na">Type</span><span class="o">=</span><span class="s">forking</span><span class="w"></span>
<span class="w"> </span><span class="na">ExecStart</span><span class="o">=</span><span class="s">/etc/rc.local start</span><span class="w"></span>
<span class="w"> </span><span class="na">TimeoutSec</span><span class="o">=</span><span class="s">0</span><span class="w"></span>
<span class="w"> </span><span class="na">StandardOutput</span><span class="o">=</span><span class="s">tty</span><span class="w"></span>
<span class="w"> </span><span class="na">RemainAfterExit</span><span class="o">=</span><span class="s">yes</span><span class="w"></span>
<span class="w"> </span><span class="na">SysVStartPriority</span><span class="o">=</span><span class="s">99</span><span class="w"></span>

<span class="k">[Install]</span><span class="w"></span>
<span class="w"> </span><span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span><span class="w"></span>
</code></pre></div>
<p>Then enable the <code>rc-local</code> service</p>
<div class="highlight"><pre><span></span><code>sudo systemctl <span class="nb">enable</span> rc-local
</code></pre></div>
<p>Finally, reboot</p>
<h2 id="gpu-drivers-cuda">GPU Drivers / CUDA</h2>
<p>Heimdall (the pulse detection part of our pipeline) relies on the CUDA toolkit. Let's install that now (version 12.3)</p>
<div class="highlight"><pre><span></span><code>wget https://developer.download.nvidia.com/compute/cuda/repos/ubuntu2204/x86_64/cuda-keyring_1.1-1_all.deb
sudo dpkg -i cuda-keyring_1.1-1_all.deb
sudo apt-get update
sudo apt-get -y install cuda-toolkit-12-3
</code></pre></div>
<p>And then install the open-source kernel drivers (Version 545) (overwriting previously installed ones)</p>
<div class="highlight"><pre><span></span><code>sudo apt-get install -y nvidia-kernel-open-555
sudo apt-get install -y cuda-drivers-555
</code></pre></div>
<p>You may want to run the following to cleanup old dependencies/driver versions that may have been preinstalled</p>
<div class="highlight"><pre><span></span><code>sudo apt-get autoremove
</code></pre></div>
<p>Reboot. Then run <code>nvidia-smi</code> to see if the CUDA version and Driver version came up correctly.</p>
<p>Finally, add the following to <code>~/.bashrc</code> to let our use use CUDA</p>
<div class="highlight"><pre><span></span><code><span class="c1"># CUDA 12.3</span>
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span>/usr/local/cuda-12.3/bin<span class="si">${</span><span class="nv">PATH</span><span class="p">:+:</span><span class="si">${</span><span class="nv">PATH</span><span class="si">}}</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:/usr/local/cuda-12.3/lib64
</code></pre></div>
<p>and <code>source ~/.bashrc</code> or relog.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>If you change CUDA versions, you'll need to update these paths!</p>
</div>
<h2 id="pipeline-dependencies">Pipeline Dependencies</h2>
<h3 id="psrdada">PSRDADA</h3>
<p>We use <a href="https://psrdada.sourceforge.net/">PSRDADA</a> to connect the packet capture and first stage processing pipeline <a href="https://github.com/GReX-Telescope/GReX-T0">T0</a> to the pulse detection framework <a href="https://sourceforge.net/p/heimdall-astro/wiki/Home/">heimdall</a>. This is a library we need to install.</p>
<p>We will build a few programs, so might as well create a directory to do this in to keep our home directory organized.</p>
<div class="highlight"><pre><span></span><code>mkdir src <span class="o">&amp;&amp;</span> <span class="nb">cd</span> src
</code></pre></div>
<p>Then clone PSRDADA</p>
<div class="highlight"><pre><span></span><code>git clone git://git.code.sf.net/p/psrdada/code psrdada <span class="o">&amp;&amp;</span> <span class="nb">cd</span> psrdada
<span class="c1"># Last tested version, bump as appropriate</span>
git checkout 008afa7
</code></pre></div>
<p>Now, install some build dependencies</p>
<div class="highlight"><pre><span></span><code>sudo apt-get install build-essential cmake ninja-build -y
</code></pre></div>
<p>Then, build PSRDADA</p>
<div class="highlight"><pre><span></span><code>mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake -GNinja ..
ninja
sudo ninja install
</code></pre></div>
<p>This will install the control programs and libraries to <code>/usr/local/bin</code> and <code>/usr/local/lib</code>, respectively.</p>
<p>We have to add the latter to out linker path, by adding the following to <code>~./bashrc</code></p>
<div class="highlight"><pre><span></span><code><span class="c1"># PSRDADA</span>
<span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:/usr/local/lib
</code></pre></div>
<p>Then, relog once agian.</p>
<h3 id="heimdall">Heimdall</h3>
<p>Similar process to build the pulse-detection software, heimdall.
First, clone our fork in our <code>~/src</code> directory:</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> ../
git clone --recurse-submodules  https://github.com/GReX-Telescope/heimdall-astro
<span class="nb">cd</span> heimdall-astro
</code></pre></div>
<p>Install some build dependencies</p>
<div class="highlight"><pre><span></span><code>sudo apt-get install libboost-all-dev -y
</code></pre></div>
<p>Then build</p>
<div class="highlight"><pre><span></span><code>mkdir build <span class="o">&amp;&amp;</span> <span class="nb">cd</span> build
cmake -GNinja ..
ninja
</code></pre></div>
<p>Run the test dedispersion program to make sure everything seemed to work</p>
<div class="highlight"><pre><span></span><code>./dedisp/testdedisp
</code></pre></div>
<p>which should return</p>
<div class="highlight"><pre><span></span><code>----------------------------- INPUT DATA ---------------------------------
Frequency of highest chanel (MHz)            : 1581.0000
Bandwidth (MHz)                              : 100.00
NCHANS (Channel Width [MHz])                 : 1024 (-0.097656)
Sample time (after downsampling by 1)        : 0.000250
Observation duration (s)                     : 30.000000 (119999 samples)
Data RMS ( 8 bit input data)                 : 25.000000
Input data array size                        : 468 MB

Embedding signal
----------------------------- INJECTED SIGNAL  ----------------------------
Pulse time at f0 (s)                      : 3.141590 (sample 12566)
Pulse DM (pc/cm^3)                        : 41.159000
Signal Delays : 0.000000, 0.000008, 0.000017 ... 0.009530
Rawdata Mean (includes signal)    : -0.002202
Rawdata StdDev (includes signal)  : 25.001451
Pulse S/N (per frequency channel) : 1.000000
Quantizing array
Quantized data Mean (includes signal)    : 127.497818
Quantized data StdDev (includes signal)  : 25.003092

Init GPU
Create plan
Gen DM list
----------------------------- DM COMPUTATIONS  ----------------------------
Computing 32 DMs from 2.000000 to 102.661667 pc/cm^3
Max DM delay is 95 samples (0 seconds)
Computing 119904 out of 119999 total samples (99.92% efficiency)
Output data array size : 14 MB

Compute on GPU
Dedispersion took 0.02 seconds
Output RMS                               : 0.376464
Output StdDev                            : 0.002307
DM trial 11 (37.681 pc/cm^3), Samp 12566 (3.141500 s): 0.390678 (6.16 sigma)
DM trial 11 (37.681 pc/cm^3), Samp 12567 (3.141750 s): 0.398160 (9.41 sigma)
DM trial 11 (37.681 pc/cm^3), Samp 12568 (3.142000 s): 0.393198 (7.25 sigma)
DM trial 11 (37.681 pc/cm^3), Samp 12569 (3.142250 s): 0.391713 (6.61 sigma)
DM trial 12 (40.926 pc/cm^3), Samp 12566 (3.141500 s): 0.441719 (28.29 sigma)
DM trial 13 (44.171 pc/cm^3), Samp 12564 (3.141000 s): 0.400574 (10.45 sigma)
DM trial 13 (44.171 pc/cm^3), Samp 12565 (3.141250 s): 0.403097 (11.55 sigma)
Dedispersion successful.
</code></pre></div>
<p>Finally, install this into our path with</p>
<div class="highlight"><pre><span></span><code>sudo ninja install
</code></pre></div>
<p>The <code>heimdall</code> executable should now be available for the pipeline as well as offline analysis.</p>
<h3 id="hdf5netcdf">HDF5/NetCDF</h3>
<p>We use the fantastic <a href="https://www.unidata.ucar.edu/software/netcdf/">netcdf</a> library to write out voltage
data. To do this, we need to statically link netcdf (and it's dependent HDF5) at compile time. As such, we
have to install these libraries systemw-wide.</p>
<div class="highlight"><pre><span></span><code>sudo apt-get install libhdf5-dev libnetcdf-dev -y
</code></pre></div>
<h2 id="rust">Rust</h2>
<p>Many parts of the pipeline software are written in the Rust programming language.
We will be building this software from scratch, so we need to install the rust compiler and its tooling.
This is easy enough with <a href="https://rustup.rs/">rustup</a></p>
<p>We need curl for the rustup installer, so</p>
<div class="highlight"><pre><span></span><code>sudo apt-get install curl -y
</code></pre></div>
<p>Then run the installer, using all the default settings</p>
<div class="highlight"><pre><span></span><code>curl --proto <span class="s1">&#39;=https&#39;</span> --tlsv1.2 -sSf https://sh.rustup.rs <span class="p">|</span> sh
</code></pre></div>
<h2 id="python">Python</h2>
<p>To get out of version hell for python stuff, we're using <a href="https://python-poetry.org/">Poetry</a>. To install it, we will:</p>
<div class="highlight"><pre><span></span><code>curl -sSL https://install.python-poetry.org <span class="p">|</span> python3 -
</code></pre></div>
<p>We need to make a few adjustments to <code>~/.bashrc</code> to correct the paths and fix a bug. Append the following to the end.</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="s2">&quot;/home/user/.local/bin:</span><span class="nv">$PATH</span><span class="s2">&quot;</span>
<span class="c1"># Fix the &quot;Poetry: Failed to unlock the collection&quot; issue</span>
<span class="nb">export</span> <span class="nv">PYTHON_KEYRING_BACKEND</span><span class="o">=</span>keyring.backends.null.Keyring
</code></pre></div>
<p>Go ahead and <code>source ~/.bashrc</code> now to get these changes in your shell.</p>
<h2 id="pipeline-software">Pipeline Software</h2>
<p>To organize all the software needed for running the whole pipeline, we will grab the metapackage from github and clone somewhere (like the home directory):</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span>
git clone --recurse-submodules https://github.com/GReX-Telescope/grex
</code></pre></div>
<p>Then, assuming you followed all the previous steps, build the pipeline software with</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /grex
./build.sh
</code></pre></div>
<p>Next, you need to setup a <code>.env</code> file with preset variables for the pipeline to access at startup.
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /pipeline
./grex.sh env
</code></pre></div></p>
<p>Edit the <code>mac=</code> line of <code>.env</code> to include the NIC MAC address (here the address is <code>80:61:5f:0a:4c:d4</code>, yours will be different).</p>
<div class="highlight"><pre><span></span><code><span class="na">mac</span><span class="o">=</span><span class="s">&quot;80:61:5f:0a:4c:d4&quot;</span><span class="w"></span>
</code></pre></div>
<p>To get you NIC MAC address, run <code>ifconfig</code> and find this section of output starting with the ethernet connection to the box (<code>enp1s0f0</code>). The address after <code>ether</code> is the NIC address.</p>
<div class="highlight"><pre><span></span><code>enp1s0f0: <span class="nv">flags</span><span class="o">=</span><span class="m">4163</span>&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu <span class="m">9000</span>
        inet <span class="m">192</span>.168.0.1  netmask <span class="m">255</span>.255.255.0  broadcast <span class="m">192</span>.168.0.255
        inet6 fe80::8261:5fff:fe0a:4cd4  prefixlen <span class="m">64</span>  scopeid 0x20&lt;link&gt;
        ether <span class="m">80</span>:61:5f:0a:4c:d4  txqueuelen <span class="m">1000</span>  <span class="o">(</span>Ethernet<span class="o">)</span>
        RX packets <span class="m">31312797155</span>  bytes <span class="m">258061589774450</span> <span class="o">(</span><span class="m">258</span>.0 TB<span class="o">)</span>
        RX errors <span class="m">10</span>  dropped <span class="m">10</span>  overruns <span class="m">0</span>  frame <span class="m">10</span>
        TX packets <span class="m">2158805</span>  bytes <span class="m">123243792</span> <span class="o">(</span><span class="m">123</span>.2 MB<span class="o">)</span>
        TX errors <span class="m">0</span>  dropped <span class="m">0</span> overruns <span class="m">0</span>  carrier <span class="m">0</span>  collisions <span class="m">0</span>
</code></pre></div>
<p>Next, make the directories where all the data will be stored and change ownership to <code>user</code> (or whatever username you use)
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> /hdd
mkdir data
sudo chown user data
mkdir data/voltages
mkdir data/filterbanks
mkdir -p data/candidates/T2
mkdir -p data/candidates/T3/candfils
mkdir -p data/candidates/T3/candplots
</code></pre></div></p>
<p>Lastly, you'll need to install the <code>parallel</code> package</p>
<div class="highlight"><pre><span></span><code>sudo apt install parallel -y
</code></pre></div>
<p>Now you can run the pipeline
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> ~/grex/pipeline
./grex.sh full
</code></pre></div></p>
<h2 id="pipeline-injection-and-coincidencing">Pipeline Injection and Coincidencing</h2>
<p>NOTE: The injection and coincidencing software (T3) is currently written to operate as services that run in the background. We are changing this to make it a proper section of the pipeline that will be installed fully with the rest of the pipeline.</p>
<h2 id="databases-and-metrics-collection">Databases and Metrics Collection</h2>
<h3 id="grafana">Grafana</h3>
<p>We use Grafana as the observability frontend.
Here, we'll assume you are going to set up a Grafana cloud (free-tier) account.
While it is possible to use a self-hosted version, we found this to be the most simple.</p>
<p>Steps:
1. Create a grafana account <a href="https://grafana.com/auth/sign-up/create-user?pg=hp&amp;plcmt=cloud-promo&amp;cta=create-free-account">here</a>
2. Pick a stack URL that makes sense
<img alt="" src="/../assets/grafana_1.png" />
3. Click "Hosted Telemetry Data"
<img alt="" src="/../assets/grafana_2.png" />
4. Click "Hosted Prometheus metrics"
<img alt="" src="/../assets/grafana_3.png" />
5. With the default settings of "via Grafana Alloy", scroll down to generate an API token (use any name).
6. Record the <code>url</code>, <code>username</code>, and <code>password</code> of the generated Alloy configuration
<img alt="" src="/../assets/grafana_4.png" />
7. Click the grafana logo in the top left corner and then hit "Get started" again.
8. This time, follow "Hosted Telemetry Data" with "OpenTelemetry (OTLP)"
9. Again, create an API token, scroll down to the generated Alloy configuration file and find the two sections for "grafana_cloud"
10. Record the <code>client.endpoint</code> and <code>username</code> and <code>password</code>
<img alt="" src="/../assets/grafana_5.png" />
11. Again, return to the home screen with the grafana logo, open the menu and navigate to "Dashboards"
12. In the top right, go to "New" and then "Import"
<img alt="" src="/../assets/grafana_6.png" />
13. Go to our observability stack and either download or copy the dashboard JSON from <a href="https://github.com/GReX-Telescope/grex_observability/blob/main/t0_dashboard.json">here</a>
14. Either load or copy the model and hit "Load" and then finish the import. This is our main pipeline visualization.
<img alt="" src="/../assets/grafana_7.png" />
15. Go back to dashboards, import again, but this type supply <code>1860</code> for the dashboard ID. This is the "Node Exporter" dashboard that will let you monitor all the metrics about your server such as disk usage, network activity, etc.
16. Select our previously setup prometheus data source
<img alt="" src="/../assets/grafana_8.png" />
17. Now, continue to the docker setup below:</p>
<h3 id="docker">Docker</h3>
<p>Following <a href="https://docs.docker.com/engine/install/ubuntu/">docker's documentation</a>, install docker the usual way as that is what orchestrates the databases, log aggregation, and communication to grafana.</p>
<p>Set docker to run as a systemd service with</p>
<div class="highlight"><pre><span></span><code>sudo systemctl <span class="nb">enable</span> docker
</code></pre></div>
<p>if you didn't already in the installation.</p>
<h3 id="observability-stack">Observability Stack</h3>
<p>Somewhere obvious (like the home dir), clone <a href="https://github.com/GReX-Telescope/grex_observability">the stack</a> and <code>cd grex_observability</code>.</p>
<p>The file <code>compose.yml</code> (in conjunction with <code>config.alloy</code>) tells Docker how to build the containers and set up the Prometheus and OpenTelemetry services. By default, <code>compose.yml</code> will utilize a predefined image of Prometheus to store data at <code>/var/lib/docker/volumes/</code> for 15 days. We want to have access to much longer time streams than this, meaning we need to change the location to somewhere on disk with greater available space and change the retention to some longer duration, say 2 years. Change the Prometheus section of <code>compose.yml</code> to the following (or to alternative disk location and retention time):
<div class="highlight"><pre><span></span><code><span class="na">prometheus:</span><span class="w"></span>
<span class="w">    </span><span class="na">image: prom/prometheus:latest</span><span class="w"></span>
<span class="w">    </span><span class="na">container_name: prometheus</span><span class="w"></span>
<span class="w">    </span><span class="na">command:</span><span class="w"></span>
<span class="w">      </span><span class="na">- &quot;--config.file</span><span class="o">=</span><span class="s">/etc/prometheus/prometheus.yml&quot;</span><span class="w"></span>
<span class="w">      </span><span class="na">- &quot;--enable-feature</span><span class="o">=</span><span class="s">remote-write-receiver&quot;</span><span class="w"></span>
<span class="w">      </span><span class="na">- &quot;--storage.tsdb.retention.time</span><span class="o">=</span><span class="s">2y&quot;</span><span class="w"></span>
<span class="w">      </span><span class="na">- &quot;--storage.tsdb.path</span><span class="o">=</span><span class="s">/prometheus&quot;</span><span class="w"></span>
<span class="w">    </span><span class="na">ports:</span><span class="w"></span>
<span class="w">      </span><span class="na">- 9090:9090</span><span class="w"></span>
<span class="w">    </span><span class="na">restart: always</span><span class="w"></span>
<span class="w">    </span><span class="na">volumes:</span><span class="w"></span>
<span class="w">      </span><span class="na">- /hdd/prometheus:/prometheus</span><span class="w"></span>
</code></pre></div>
Check the UID and GID of the Prometheus image (most likely 65534:65534, equivalent to nobody:nogroup).
<div class="highlight"><pre><span></span><code>docker run --rm prom/prometheus sh -c &#39;id&#39;
</code></pre></div></p>
<p>Now make <code>/hdd/prometheus</code> and give the service ownership so it can write to it.
<div class="highlight"><pre><span></span><code>mkdir /hdd/prometheus
sudo chown -R 65534:65534 /hdd/prometheus
</code></pre></div></p>
<p>Copy <code>alloy.env.example</code> to <code>alloy.env</code> and fill out the sections according to your grafana configuration.</p>
<ul>
<li><code>GRAFANA_OTLP_ENDPOINT</code> is <code>client.endpoint</code> from the OpenTelemetry config</li>
<li><code>GRAFANA_OTLP_USER</code> is <code>username</code> from the OpenTelemetry config</li>
<li><code>GRAFANA_OTLP_PASSWORD</code> is <code>username</code> from the OpenTelemetry config</li>
<li><code>GRAFANA_PROM_ENDPOINT</code> is <code>url</code> from the Prometheus config</li>
<li><code>GRAFANA_PROM_USER</code> is the <code>username</code> from the Promethus config</li>
<li><code>GRAFANA_PROM_PASS</code> is the <code>password</code> from the Prometheus config</li>
</ul>
<p>Following the Grafana example above, a completed <code>alloy.env</code> file will look like this
<img alt="" src="/../assets/grafana_9.png" /></p>
<p>Test the stack with</p>
<div class="highlight"><pre><span></span><code>sudo docker compose up
</code></pre></div>
<p>Navigate to your Grafana <code>Node Exporter Full</code> dashboard (it may take a reselect of <code>Datasource</code> to populate) but you should now see the dashboard with all its data.</p>
<p><code>Ctrl-C</code> out of that and then start up the stack in the background with</p>
<div class="highlight"><pre><span></span><code>sudo docker compose up -d
</code></pre></div>
<h2 id="pi-ssh">Pi SSH</h2>
<p>The last thing will be to configure easy access to the Raspberry Pi's SSH. We can do that by creating a passwordless SSH key and installing it on the pi. We're going to be behind ssh anyway, and the Pi isn't public-facing, so this is a safe thing to do.</p>
<p>On the server, generate a new ssh keypair with</p>
<div class="highlight"><pre><span></span><code>ssh-keygen -t rsa
</code></pre></div>
<p>Then, install it on the pi with</p>
<div class="highlight"><pre><span></span><code>ssh-copy-id pi@192.168.0.2
</code></pre></div>
<p>Finally, create an SSH config that automatically supplies the hostname and user:</p>
<p>Create a file on the GReX server in <code>~/.ssh/config</code> with the contents</p>
<div class="highlight"><pre><span></span><code>Host pi
    Hostname 192.168.0.2
    User pi
</code></pre></div>
<p>Now you can test the easy connection with</p>
<div class="highlight"><pre><span></span><code>ssh pi
</code></pre></div>
<p>All done! We should now be ready to run the pipeline!</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../pipeline/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Pipeline" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Pipeline
            </div>
          </div>
        </a>
      
      
        
        <a href="../box/" class="md-footer__link md-footer__link--next" aria-label="Next: Box Setup" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Box Setup
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "navigation.instant", "navigation.tabs"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a6c66575.min.js"></script>
      
    
  </body>
</html>