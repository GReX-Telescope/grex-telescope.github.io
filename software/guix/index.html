
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://grex-telescope.github.io/software/guix/">
      
      <link rel="icon" href="../../assets/grex_icon.svg">
      <meta name="generator" content="mkdocs-1.3.0, mkdocs-material-8.2.15">
    
    
      
        <title>Guix - GReX Telescope</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.c382b1dc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.cc9b2e1e.min.css">
        
      
    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pipeline-modules-and-guix" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="GReX Telescope" class="md-header__button md-logo" aria-label="GReX Telescope" data-md-component="logo">
      
  <img src="../../assets/grex_icon.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            GReX Telescope
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Guix
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../hardware/overview/" class="md-tabs__link">
        Hardware
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../overview/" class="md-tabs__link md-tabs__link--active">
        Software
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../about/" class="md-tabs__link">
      About
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="GReX Telescope" class="md-nav__button md-logo" aria-label="GReX Telescope" data-md-component="logo">
      
  <img src="../../assets/grex_icon.svg" alt="logo">

    </a>
    GReX Telescope
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_2">
          Hardware
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Hardware" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Hardware
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/feed/" class="md-nav__link">
        Feed Antenna
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/fem/" class="md-nav__link">
        Fronend Module
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/fpga/" class="md-nav__link">
        Digital Backend
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/box/" class="md-nav__link">
        The Box
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../hardware/assembly/" class="md-nav__link">
        Assembly Guide
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          Software
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Software" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Software
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../gateware/" class="md-nav__link">
        Gateware
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../snap/" class="md-nav__link">
        SNAP
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Guix
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Guix
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#partitions" class="md-nav__link">
    Partitions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initial-installation" class="md-nav__link">
    Initial Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initial-system-setup" class="md-nav__link">
    Initial System Setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../pipeline/" class="md-nav__link">
        Pipeline
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../about/" class="md-nav__link">
        About
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
    <nav class="md-nav" aria-label="Installation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#partitions" class="md-nav__link">
    Partitions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initial-installation" class="md-nav__link">
    Initial Installation
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initial-system-setup" class="md-nav__link">
    Initial System Setup
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                


<h1 id="pipeline-modules-and-guix">Pipeline Modules and Guix</h1>
<p><a href="https://guix.gnu.org/">Guix</a> is a functional package manager and tool to
instantiate and manage Unix-like operating systems. By functional, Guix defines
packages through a purely functional deployment model in which every build is
deterministic and is a pure function of the package's "inputs" or dependencies.
This solves the problem of <a href="https://en.wikipedia.org/wiki/Dependency_hell">dependency
hell</a> and reproducability.</p>
<p>For GReX, many of our software modules and components exist as forks of
preexisting software as well as some custom code. To ensure all of these
components work together in harmony, we'll host a guix channel that provides the
build recipes for our software
<a href="https://github.com/GReX-Telescope/guix-grex">here</a>. Most of this software,
however, relies on the non-free CUDA runtime.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>As a note, we are using non-free CUDA as to leverage high-performance preexisting code.
CUDA, and non-free software in general, denies users the ability to study and modify it.
This is detrimental to user freedom and to proper scientific review and experimentation.
As such, we ask that you not share these modules widely as to encourage more open alternatives.</p>
</div>
<p>To utilize any of our packaged software, you must add our channel to your <code>channels.scm</code></p>
<div class="highlight"><pre><span></span><code><span class="p">(</span><span class="nb">cons</span><span class="w"> </span><span class="p">(</span><span class="nf">channel</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="nf">name</span><span class="w"> </span><span class="ss">&#39;guix-grex</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="nf">url</span><span class="w"> </span><span class="s">&quot;https://github.com/GReX-Telescope/guix-grex.git&quot;</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="p">(</span><span class="nf">branch</span><span class="w"> </span><span class="s">&quot;main&quot;</span><span class="p">))</span><span class="w"></span>
<span class="w">      </span><span class="nv">%default-channels</span><span class="p">)</span><span class="w"></span>
</code></pre></div>
<h2 id="installation">Installation</h2>
<p>To start from a bare server, we need a few prerequisites. First, to actually
build the install image, you need guix the guix binary installed. Installer isos
will be provided, eventually.</p>
<p>Clone the <a href="https://github.com/GReX-Telescope/guix-grex">GReX Guix</a> repo and run,
this may take a while.</p>
<div class="highlight"><pre><span></span><code>$ guix system image --image-type<span class="o">=</span>iso9660 grex/system/install.scm
</code></pre></div>
<p>After that, make an installation media, either CD or USB and boot into it. If
you want to make a USB, simply</p>
<div class="highlight"><pre><span></span><code>$ sudo dd <span class="k">if</span><span class="o">=</span>&lt;the iso that was created&gt; <span class="nv">of</span><span class="o">=</span>/dev/&lt;your USB&gt; <span class="nv">status</span><span class="o">=</span>progress <span class="nv">bs</span><span class="o">=</span>32M <span class="o">&amp;&amp;</span> sync
</code></pre></div>
<p>Once you boot into the installation media, select "Install using the shell based
process"</p>
<h3 id="partitions">Partitions</h3>
<p>We'll partition the servers with UEFI, you can use any tool you like for this, I
like <code>cfdisk</code>. You'll need to make a 512M vfat partition for EFI and then ext4
the rest.</p>
<p>Then, format and mount the partitions</p>
<div class="highlight"><pre><span></span><code>mkfs.ext4 /dev/root_partition
mkfs.fat -F <span class="m">32</span> /dev/efi_system_partition
mount /dev/root_partition /mnt
mkdir -p /mnt/boot/efi
mount /dev/efi_system_partition /mnt/boot/efi
</code></pre></div>
<p>Now we can setup the installation environment with</p>
<div class="highlight"><pre><span></span><code>herd start cow-store /mnt
</code></pre></div>
<h3 id="initial-installation">Initial Installation</h3>
<p>First, we need to grab the system configuration for <em>this</em> machine (assuming it
exists). GReX servers we control will have their own configuration file.</p>
<div class="highlight"><pre><span></span><code>git clone https://github.com/GReX-Telescope/guix-grex
</code></pre></div>
<p>First, we'll copy over the channels and update (this may take a while)</p>
<div class="highlight"><pre><span></span><code>mkdir -p ~/.config/guix
</code></pre></div>
<p>Then open your editor of choice (we include vim and emacs in the installer
image) and add the channels form from above to <code>~/.config/guix/channels.scm</code></p>
<p>Then</p>
<div class="highlight"><pre><span></span><code><span class="nv">guix</span><span class="w"> </span><span class="nv">pull</span><span class="w"></span>
<span class="nb">hash</span><span class="w"> </span><span class="nv">guix</span><span class="w">  </span><span class="o">#</span><span class="w"> </span><span class="nv">This</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">necessary</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">ensure</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">updated</span><span class="w"> </span><span class="nv">profile</span><span class="w"> </span><span class="nv">path</span><span class="w"> </span><span class="nv">is</span><span class="w"> </span><span class="nv">active!</span><span class="w"></span>
</code></pre></div>
<p>Then initialize the system with</p>
<div class="highlight"><pre><span></span><code><span class="nb">cd</span> guix-grex
guix system -L . init grex/system/&lt;specific server&gt;.scm /mnt
</code></pre></div>
<p>For example, we can provision the <code>grex-01</code> server with</p>
<div class="highlight"><pre><span></span><code><span class="nv">guix</span><span class="w"> </span><span class="nb">system</span><span class="w"> </span><span class="nv">-L</span><span class="w"> </span><span class="o">.</span><span class="w"> </span><span class="nv">init</span><span class="w"> </span><span class="nv">grex/system/grex-01</span><span class="o">.</span><span class="nv">scm</span><span class="w"> </span><span class="nv">/mnt</span><span class="w"></span>
</code></pre></div>
<h3 id="initial-system-setup">Initial System Setup</h3>
<p>Now you can reboot and setup the users!</p>
<p>First, we need to change the password. Login as root and</p>
<div class="highlight"><pre><span></span><code>passwd      <span class="c1"># For root</span>
passwd grex <span class="c1"># For the GReX user</span>
</code></pre></div>
<p>Then, do the same steps of adding the GReX channels list to
<code>~/.config/guix/channels.scm</code> and then one final pull</p>
<div class="highlight"><pre><span></span><code>guix pull
</code></pre></div>
<p>We're ready to go!</p>

              
            </article>
          </div>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        
        <a href="../snap/" class="md-footer__link md-footer__link--prev" aria-label="Previous: SNAP" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              SNAP
            </div>
          </div>
        </a>
      
      
        
        <a href="../pipeline/" class="md-footer__link md-footer__link--next" aria-label="Next: Pipeline" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Pipeline
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["header.autohide", "navigation.instant", "navigation.tabs"], "search": "../../assets/javascripts/workers/search.2a1c317c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.a6c66575.min.js"></script>
      
    
  </body>
</html>